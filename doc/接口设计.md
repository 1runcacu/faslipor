[TOC]

# 后端api接口

端口：8101
服务器ip：43.143.130.52

数据包定义： json数组（data，state）



首先这个接口 我们从安全性角度讲 统一用这个post

然后第二点就是 我上报的所有数据都采用json格式



注册请求 不能用url去注册

请求格式：body:{

​	action:"具体的请求接口名称",//参数藏在这里 而不是链接里面

​	data:{

​		...参数键值对

​	}

}

目前按照这种规范

请求走统一接口

比如: http://43.143.130.52:8101/faslipor 后面是具体的数据帧body

采用这种方案的话 是可以随时对这个body加密的 



暂时应该没有了

因为如果按照我之前的又一个唯一ID 全局存在的话

我的方案可能是 每个请求 都会带上这个ID（相当于TOKEN了）

然后在解析我的数据body的时候

第一步验证ID有效性 然后再去做具体逻辑（比如加入房间 或者创建房间）

打开这个http://localhost:8100之后 就会自动发送一个注册请求了

我又打开 又会重新注册的 刷新也会重新注册

然后注册的时候 你得看一个报文头 refer()好像 就是你的请求来自于哪里 只有在我的界面里 发送注册请求 才是合法的

资料：

[(46条消息) HTTP_ORIGIN 说明_心飞路漫的博客-CSDN博客_http_origin](https://blog.csdn.net/qq_34924407/article/details/85495508)

[http协议首部---referer，标明请求来源 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/61996660)

或者 origin



增量帧的话，这时候用的套接字

也是json对象 我想想结构 因为socket不一定只发增量帧 还可能是后期做一些别的通信 然后尽可能和上面统一

请求格式：body:{

​	action:"信令上报(换个英文)",//参数藏在这里 而不是链接里面

​	id:"用户xxx",

​	房间id:"xxxx",

​	data:{

​		图元参数数组:[

​			{xxxx:xxxxx}

​		],

​		多余信息键值对...

​	},

}

对 对 目前你把这个转json之后 先不处理 假设没有冲突 直接给我前端发送

对 后端直接忽略 直接转发 后端重要的是 准确的给我所有房间用户 转发 对



对了 又一个重要的 是 我们的socket链接几个？



不 从优化角度讲 前端只应该和后端链接一个socket



比如 我在[FASLIPOR](http://localhost:8100/)这个页面的时候 假设你那边创建房间了 或者删除房间了 我这边必须实时更新



比如我现在进入了一个房间 然后退出来回到首页 这个时候 socket要不要关闭？那这样的缺点是什么



所以我们能不能从头到尾 只用一个socket 永远不关闭的 实现所有功能

对于一个应用 就是打开这个软件 到关闭



我的方案是 post都不用了 哈哈哈 利用socket做握手

所有阶段都用socket 都用socket

nonono 那个列表我确实可以直接get或者post 但是

如果你的房间在实时更新的时候

get和post没法同步 

因为我不知道啥时候更新了

听不清 哈哈哈



因为get只能拿到一次数据

一但有用户创建房间之后 我必须在get获取到这个列表 才能前端展示最新的

对 不需要我去发送请求 直接发送我 当然了 要留一个接口 就是 我第一次打开是没有数据的 需要socket发送一个请求 这时候你给我发列表 通过socket 

对 然后你那边有更新就自动发列表 我会自动更新 对





接下来第一件事就是socket的链接 以及数据的发送

还有一个重要点就是 socket断开之后 会报错 你那边得处理处理

对

比如我前端突然叉掉了

或者我网断了 但这个不一样 假设我断网了一分钟 然后又好了 我这边会重新发起链接 这个怎么处理

可以带 只要没有关掉界面 就会含有原来的所有数据 反正得注意 哈哈哈

或者我刷新了

对 都算是一种断开

哪个 没听清 

断网了 哈哈哈 听不到 哈哈哈

| 功能       | 请求方法     | 链接      | 参数     | 返回参数                           |
|----------|----------|---------|--------|--------------------------------|
| 获取所有房间信息 | websocket | /login/list | 无      |    json数组（房间信息）           |
| 搜索（前端）   |          |         |        |                                |
| 创建房间     | websocket |         |        |                                |
| 加入房间     | websocket | /login/ | String | json数组（最近的全量帧及之后的增量帧及房间信息，个人信息） |
|          |          |         |        |                                |
|          |          |         |        |                                |
|          |          |         |        |                                |



| 前端监听事件     | 数据格式        | 参数定义                                                                                                                                                                                          |
| ---------------- | --------------- |-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| asset            |                 |                                                                                                                                                                                               |
| message          | {message,type}  | type:success\                                                                                                                                                                                 |
| stream           |                 | stamp事件  String event,String uid,String rid，frame：null <br/>increment 事件(String event,String uid,String rid,frame:{String stamp,String gid,String type, style:{int left,int top,int radius}}) |
| reset            |                 |                                                                                                                                                                                               |
| redirect         | {path,params}   |                                                                                                                                                                                               |
| **后端监听事件** | **数据格式**    | **参数定义**                                                                                                                                                                                      |
| query            | {event,params}  | 3种event String类型(list,select,add)对应params分别是(null),(String rid),(String roomName,String brief)                                                                                                |
| stream           | {uid,rid,frame} | increment 事件(String event,String uid,String rid,frame:{String gid,String type, style:{int left,int top,int radius}}) <br/> stamp (String event,String uid,String rid,frame:{String stamp})    |
| reset            | {uid,rid,frame} | (String uid,String rid,String frame)                                                                                                                                                          |

```javascript
asset=>{
  event:"list",
  state:200,
  data:[
    {
      rid:"xxx",
      name:"xxx",
      state:"xxx",
      description:"xxx",
      stats:233,
      limit:10
    },{
      rid:"xxx",
      name:"xxx",
      state:"xxx",
      description:"xxx",
      stats:233,
      limit:10
    }
  ]
}
```





​                             

​       

​                       

​                                       